1.5.2

- **BREAKING CHANGES**
Необходимо добавить в описание в секцию servers директиву `x-env`, которая указывает какой адрес к какому окружению привязан

Что нового:
1. Улучшен парсинг директивы `servers`

1.6.3

[*] Исправлен баг с default null, который приводил null к типу

1.6.5

[+] Добавлена функция для создания логера извне

1.6.6

[*] Undefined значения теперь не записываются в качестве параметров

1.6.7

[+] Переменные из меты сами встают к остальным переменным в обработчике

1.6.8

[+] Для ключей объекта теперь можно использовать описание через oneOf

1.6.9

[*] Fix: Если ни одна схема не прошла через oneOf как валидная, то вылетело с ошибкой.
    Теперь корректно обработано

1.6.10

[*] Теперь UI дополнительно открывается с корня (/)

1.6.11

[*] Пофикшен баг, при котором любой несуществующий путь вел на страницу документации

1.6.12

[*] Увеличен объем данных, которые может принять сервис

1.6.13

[*] Json файлики теперь тоже работают, если передать название сервиса при инициализации

1.6.14

[*] Оптимизация логера
[*] Добавление ватчера на варнинги ноды

1.7.0

- **BREAKING CHANGES**
[+] Добавлен модуль для работы с настройками
[*] Пофикшен баг с целыми числами, которые приводились к 32битному инту
[*] Пофикшен баг с логером (warning вместо warn)

1.8.0

[+] Либка для межсервисных запросов
[*] Небольшие оптимизации

1.9.0

[+] Добавлено новое стандартное дополнение - конфиг
[*] Убрана проверка на папку specifications
[*] Пофикшена ошибка с функцией-ошибкой

1.9.0 - 1.9.2 - проблемы с нпмом

1.9.3

[+] Добавлено новое стандартное дополнение - конфиг
[*] Убрана проверка на папку specifications
[*] Пофикшена ошибка с функцией-ошибкой

1.9.4

[+] Отключен CORS

1.10.0

[+] Добавлена возможность вызова дополнений в зависимости от operationId

1.11.0

[+] Добавлены кастомные дополнения (MySQL)

1.12.0

[+] При ошибке при валидации добавлен путь, который показывает (примерно), где она возникла

1.12.1

[*] При обращениях в цикле к другим сервисам состояние перезаписывалось. Пофикшено, конечно, но не надо так делать :)

1.13.0

[+] Добавлены события

1.14.0

[+] Добавлена возможность инициировать события

1.14.1

[+] Не правильно парсилось из конфига EVENTS_HOST и EVENTS_PATH. Пофикшено.

1.14.2

[*] Параметры на уровне пути не учитывались, пофикшено
[*] Дописаны тесты
[*] Повышены версии пакетов с уязвимостями, на которые ругался npm

1.15.0

[+] Реализованы allOf и anyOf (https://swagger.io/specification/#schemaObject)
[*] Обновлены версии зависимостей

1.15.1

[+] Реализован catch в api
[*] Пофикшены баги с боди и параметрами

1.15.2

[*] В боди можно было отправлять только строку, теперь можно все

1.16.0

[+] В контроллер первым аргументом вместе с отальными параметрами будет приходить ключ lang наравне с userId (сделано ранее).
    В нем лежит текущий язык пользователя, который можно использовать для локализации

1.16.1

[+] Фикс anyOf, oneOf (https://swagger.io/specification/#schemaObject)

1.16.2

[*] Пофикшены query-параметры, тип boolean

1.16.3

[*] Пофикшено преобразование body запроса при контенте = application/json

1.16.4

[*] Нормальный способ фикса проблемы выше

1.16.5

[*] Пофикшен баг, когда прислано число в тело запроса, а он посылал на отдых

1.16.6

[+] Теперь из интерфейса в сервис отправляется сессия по умолчанию
    (userId = 0; sessionId = 'system'; lang = 'ru-RU')
[*] Ошибка, когда не удается распарсить тело, больше не пишется в консоль

1.16.7

[+] Поля из базы с типом timestamp преобразуются из объекта в строку

1.16.8

[*] Локализация каталогов вынесена в сервис каталогов

1.17.0

[+] В опции экстеншенов добавлен флаг useApi, для проброса api-клиента в экстеншен

1.18.0

[+] Добавлен заголовок Content-Length
[*] Исправлен баг, при котором нельзя было использовать nullable в enum
[*] Исправлен баг с отправкой числа в ответ на запроса
[*] Оптимизации
[*] Реорганизованы тесты
[-] Удален lodash из проекта

1.19.0

[+] Добавлено кастомное дополнение для отправки http-запросов (fetcher)

1.20.0

[+] Добавлено кастомное дополнение для кэширования данных cache
[*] Изменено дополнение catalogs, для получения значений по имени каталога

2.0

[-] Файлы формата json больше не поддерживаются
[-] Удален пакет со статистикой, которому так и не нашлось применение
[+] Добавлена поддержка int64 чисел
[*] Улучшены сообщения об ошибках
[*] Изменен валидатор JSON Schema на более быстрый и функциональный
[*] Теперь валидируются только ответы со статус кодом = 200
[*] Ранее, когда вы передавали что угодно отличное от массива туда,
    где необходим массив, это конвертировалось в массив с одним элементом. Теперь - нет
[*] Отныне не обязательно указывать в спецификации коды 400, 500, 403
[*] Обработанные руками ошибки теперь отделены от необработанных
[*] Сильно переписаны мидлвары валидации, роутинга. Добавлена мидлвара ошибок
[+] Система плагинов
[+] Куча новых тестов

2.0.1

[*] Попытка пофиксить путь в загрузке документа

2.0.2

[*] Пофикшен баг с квери параметром с типом массив с единственным элементом - теперь обрабатывается корректно
    // изменение на 202 строке этого документа откатилось

2.0.3

[*] Пофикшен бан с отправкой пустого тела в ответе

2.1

[+] Добавлена возможность указывать тип контента при запросе в сервис
[*] Ошибки, которые могут возникнуть при обращении в сервис, стандартизованы
[+] В delete запросах теперь можно передавать тело

2.1.2
[+] Исправлено получение прав несуществующего пользователя


2.2.0

[+] Добавлено расширение для загрузки файлов через сервисы

2.3.0

[+] Добавлен эвент onReady, который срабатывает после инициализации сервиса и возвращает api, config

2.4.0

[+] При ошибке в сервисе теперь в мете всегда приходит имя сервиса и метода
[*] Исключаем сторонние файлы в интерфейсах, теперь читаем только .service

2.5.0

[+] Вместо citiesIds теперь передаются officesIds и mainOfficeId

2.6.0

[+] Список городов и главный город в мете вернулись обратно

2.7.0

[+] Добавлена тарссировка запросов

2.7.1

[*] Пофикшен прод конфиг

2.8.0

[*] Окончательно (надеюсь) решены все проблемы с ошибками и их пробросом внутри системы
[*] Пара оптимизаций

2.9.0

[+] В fetcher добавлена возможность отправлять x-www-form-urlencoded

2.10.0

[+] Добавлена возможность передавать свои функции для маппинга данных из бд

2.10.1

[+] В эвент onReady добавлена bd в возвращаемый объект

2.11.0

[+] Добавлена возможность игнорирования прав (для вызовов из других доверенных приложений)

2.11.1

[*] Поправлена валидация пустых объектов

2.11.2

[+] В fetcher добавлена возможность отправлять массивы при x-www-form-urlencoded

2.12.0

[+] В хуки типа after добавлен в параметры ответ от сервиса
[+] Появилась возможность регистрировать свои хуки
[+] Теперь в заголовоке страницы имя сервиса
[+] Вместо cURL запроса в интерфейсе пишется запрос в сервис (с некоторыми ограничениями)

2.13.0

[*] Обновились все зависимости
[+] Появился путь для проверки жизни приложения



2.13.1

[*] Исправлена ошибка с одинаковыми параметрами в конфигах development и production


2.13.2

[+] В fetcher добавленна проверка типа value при использовании FormData

2.13.3

[+] Добавлена функция локализации текста, позволяющая передать язык в параметрах

2.13.4

[*] Небольшой фикс для поиска спецификации при прод деплое (грязный хак, уберется в версии 3.0)

2.14.0

[*] Из фреймворка в отдельный пакет извлечен код JSONSchema validator

2.14.1

[+] В fetcher добавлена возможность отправлять кодировку (encoding)

3.0.0

[*] Глобальный рефакторинг
[+] При обращении из умного сервиса в умный теперь вновь прокидывается мета
[+] В мету добавлена таймзона (ключ tz)
[-] Кастомные мидлвары, не использовались
[*] BREAKING возвращение пустого результата отправляет пустую строку
[-] Возможность отключения валидатора и роутера
[*] Express.js заменен на fastify.js
[*] Переписан UI
[+] Теперь в UI сервиса можно устанавливать мету
[+] В конфигах появилась переменная с обозначением адреса окружения (например для формирования ссылок) (host)
[-] API из обычных сервисов
[+] Новая система загрузки кастомных дополнений
[*] Переделана работа с кешем
[*] Переделана загрузка спецификаций сервисов
[*] Изменен порт по умолчанию (10000)
[-] Из плагинов удален логер (вы можете самостоятельно его создать)
[*] Переделан загрузчик спецификации самого сервиса
[+] Реализован координатор (SD)
[-] Из поддерживаемых HTTP методов удален trace
[+] Добавлены метрики
[-] Удалена настройка путей для UI
[*] Редис перенесен в основные модули (был дополнением)
[+] Добавлен резолвер для енумов
[+] Добавлен резолвер для шаред типов
[+] Шаред типы перенесены в сам фреймворк
[*] Добавлены новые и удалены неактуальные тесты

3.1.2

[+] Добавлена временно обратная совместимость между сервисами 2ой и 3ей версии
[*] Исправлен пример в шаред типах
[*] Исправлена ошибка с пустым body при указании заголовка Content-Type: application/json

3.1.3

[+] Добавлен конфиг по умолчанию для fetcher

3.1.4

[*] Исправлена ошибка в enumResolver когда 0 считывалось как false и енум приобретал тип string

3.1.6

[*] Пофикшено дополнение для базы, которое приходит в событие onReady

3.1.7

[*] Исправлена отправка запросов с пустой метой

3.1.8

[*] Замена группы esoft_private на ecosystem

3.1.9

[*] Вновь пофикшено событие onReady

3.2.0

[+] Изменён uploader, теперь стучится в сатурн

3.2.1

[*] Недокументируемый фикс

3.2.2

[*] Пофикшен баг в апи с тем, что не видно контроллер сервисов

3.2.3

[*] Исправлен серьезный баг с шаред памятью в переменных реквеста

3.2.4

[+] В шаредные типы добавлен Predicate
[*] В запросе на получение каталога изменилось значение сортировки со строкового на енум

3.2.5

[*] Обновлена версия библиотеки knex для поддержки onConflict в конструкторе запросов

3.3.0

[+] Добавлен механизм настройки плагинов и хуков

3.4.0

[+] Добавлен шаред, который отсутствовал
[*] Обновлена минимальная версия ноды

3.4.1

[*] Поднята версия енумов

3.4.2

[*] Поднята версия енумов

3.4.3

[*] uploader добавлен в событие onReady

3.4.4

[*] Поднята версия енумов

3.4.5

[*] fetcher добавлен в событие onReady

3.4.6

[*] Поднята версия енумов

3.5.0

[*] Изменилась проверка на бизнесовый сервис

3.5.1

[*] Поднята версия валидатора

3.5.2

[*] Пакет с енумами удален из-за возникающих коллизий с версией, которая установлена в самом сервисе
    Перед тестами он теперь ставится отдельно

3.5.3

[*] Поправлена подстановка null, в случае, если в params описано nullable: true и значение не передано

3.6.0

[+] Добавлены отложенные события
[*] Сервис отключается более безопасно
[-] Удалена обратная совместимость между сервисами разных мажорных версий

3.6.1

[*] Исправлен баг со смертью сервиса

3.6.2

[*] Енум с режимами отправки события стал статическим по отношению к сервису

3.6.3
[-] Удален cdnId в uploader extension

3.7.0

[*] Добавлено расширение сервисов для записи в etcd
[*] Добавлен параметр seetings при запуске хуков плагинов

3.8.0
[*] catalogs добавлен в событие onReady

3.8.1
[+] Добавлен новый объект PhoneWithPlus в shared типы спецификации.

3.9.0

[+] Добавлено событие terminate, которое вызывается, если сервису нужно завершить свою работу
[*] Добавлена проверка хеша для загрузки спецификации сервисов по сети
[+] Добавлена возможность делать свои метрики
[+] Добавлены метрики по плагинам (кол-во запусков, кол-во ошибок)
[-] Удален fetcher из расширений, которые попадают в событие onReady
[+] Добавлено много тестов
[-] Убрана возможность делать свои хуки
[+] Каждому хуку добавлена ссылка на родительский плагин
[-] Из хуков убрано имя родительского плагина
[+] Добавлена возможность записывать логи в Loki
[*] Рефакторинг логера
[+] В события вторым аргументом добавлены расширения

3.9.1

[+] В настройках плагинов добавлен ключ all

3.9.2

[*] При выполнении executable расширения возникающая ошибка больше не крашит сервис
[*] Фикс утечки памяти в логере

3.9.3

[*] Обработка исключений в EventEmitter

3.10.0

[+] Добавлен вспомогательный класс ConnectionPool для пула запросов

3.10.1

[+] Рефакторинг класса PluginSettings

3.10.2

[+] localization добавлен в расширения, которые попадают в событие onReady

3.10.3

[*] Трансформация abort

3.10.4

[*] Пофикшена загрузка спецификации когда загружена неверная схема

3.10.5

[*] Пофикшено api в расширениях catalogs и localization, которые попадают в события

3.10.6

[+] HexColor в shared типах спецификации

3.10.7

[*] Пофикшена загрузка дубликатов настроек плагинов

3.10.8

[+] Добавлены настройки плагинов по settlements

3.10.9

[+] В класс плагина добавлены методы getSettingsByCity, getSettingsByOffice и getSettingsBySettlement

3.10.10

[*] Изменено название параметра (с userId на id) в методе, который обращается к users.getUserPermissions

3.11.0
[+] Добавлена поддержка ssl-сертификатов для fetcher

3.11.1
[+] Добавлены новые типы для спецификации: Filter и FilterItem
    https://youtrack.esoft.tech/issue/NCRM-10286

3.12.0
[+] Добавленно описание типов внешних интерфейсов библиотеки, для использования с TypeScript модулями


3.12.1
[*] uploader добавлен в событие onReady

3.12.2
[+] Добавлена возможность отключения проверки ssl-сертификата (по дефолту включена)
    https://youtrack.esoft.tech/issue/NCRM-9775

3.13.0
[+] metrics добавлен в событие onReady

3.14.0
[+] Добавлен шаредный тип RichText

3.14.1
[+] Добавлены типы `DBTransaction` и `DBQueryBuilder` для внешнего интерфейса

3.15.0
[+] Добавлен источник source в мету

3.15.1
[*] Изменен шаредный тип RichText: свойства "blocks" и "entityMap" стали обязательными
    https://youtrack.esoft.tech/issue/MTE-3103

3.15.2
[+] Исправлено описание типов ошибок, возвращаемых `Service.Exceptions`

4.0

[*] Обновлены пакеты на актуальные версии
[-] Удалена старая функция отправки события, которая была объявлена устаревшей почти год назад
[+] Теперь сервер правильно завершает свою работу после команды завершения
[*] Переподключение к etcd проходит быстрее и более не имеет ограничения по попыткам
[+] Добавлен shared контекст для плагинов
[+] Добавлен контекст для плагинов
[*] Изменены аргументы у функции action хука и плагина
[-] Модуль querystring, который был объявлен устаревшим, заменен на совеременный аналог
[*] Теперь каталоги загружаются только на одном нужном языке (ранее загружались все локализации)
[+] Добавлено локальное кеширование каталогов (полуавтоматическое)
[-] Функция conditionToExec удалена из хуков и плагинов
[-] Удалена принудительная регистрация хуков в виду ненадобности
[+] Добавлены хуки на события (prefix: onEvent)
[*] Переделан трейсер на новую спецификацию трейсинга
[*] Дополнение cache было переделано. Теперь все функции могут выбрасывать ошибку; добавлена функция проверки ключа
[*] Система дополнений полностью переделана
[*] Все дополнения переписаны на новую версию
[*] Фетчер теперь не надо вызывать каждый раз
[*] В логере отображается информация о текущей операции вместо константного Handler
[-] operations из дополнений были удалены
[-] Удалены функции генерирующие имя операции и контроллера, если их не удалось обнаружить (никогда не были использованы)
[*] Улучшен текст ошибки при упавшей валидации, где данные не прошли по схемам oneOf, anyOf, allOf
[+] Добавлена трасировка для базы
[+] Добавлена трасировка для хуков
[+] Добавлены асинхронные хуки
[*] Поправлена ошибка, при которой слишком большие спаны не записывались
[+] Добавлена трасировка для событий
[+] Добавлены персистентные соединения для апи
[+] Добавлены персистентные соединения для отправки событий
[+] Возможность получения дополнительной информации о запросе через заголовки
[+] Добавлены метрики на персистентные соединения
[*] Изменена структура конфигурации
[*] Переделан валидатор для allOf, oneOf, anyOf
[*] Теперь валидация проходит одновременно с ковертацией, что позволяет ускорить проверку входных параметров
[*] Улучшено уведомление об ошибках валидации для схем allOf, oneOf, anyOf
[*] Режим по умолчанию для событий - QUEUE
[+] Реализован режим для событий - QUEUE
[+] В дополнение для кеша добавлена возможность установить время жизни кеша
[+] Теперь можно включать режим дебага без перезагрузки сервиса
[*] Переписаны тесты
[*] chai + mocha заменены на jest
[+] Добавлено очень много новых тестов
[*] bigInt -> x-big-int
[+] добавлена директива для отключения конвертации в oneOf, allOf, anyOf
[+] реализован дескриминатор для объектов со схемой oneOf
[*] Обновлены все типы для typescript
[+] Добавлено логирование для плагинов
[*] Теперь при регистрации сервиса отправляется IP
[+] Если сервис готовится к завершению, то просим потребителей закрывать все постоянные соединения
[*] Поправлена валидация 0, null, false значений. Ранее они не всегда проверялись :(
[*] Поправлена ошибка с апи когда при использовании then catch иногда не возвращался результат

4.0.1

[*] Пофикшена регистрация сервиса

4.0.2

[*] Пофикшены query параметры, когда в них пытаются передать массив

4.1

[*] Теперь дополнения должны инициироваться в функции load, а не в конструкторе
[*] Пофикшена ошибка при загрузке сервиса

4.1.1
[*] Фикс коннекта к etcd
[*] Фикс текстов ошибок

4.1.2

[*] Исправлена ошибка при которой расширения всегда писали детальную инфломацию в трейсах

4.1.3

[*] Пофикшена загрузка файлов с предзаданным разрешением

4.1.4

[+] Ref в расширение pg

4.2.0

[-] Убран запрет изменения входных и выходных параметров в асинхронных хуках (не получается по нормальном заблокировать програмно :( )
[+] Новая функция для изменения входных параметров

4.2.1

[*] Исправлено дебаг сообщение при отправке запроса в сервис
[*] Исправлено отсутствие трассировки между 3 и 4 версией
[*] Версия либы для парсинга рефов была понижена до версии на третей версии фреймворка
[*] Обработка ситуации когда ошибка, которая возникла в процессе обработки запроса, по какой-то причине не является объектом

4.2.2

[*] Исправлена обработка shared-типа DateShortFormat для спецификации

4.2.3

[*] Исправлен тип возвращаемого значения при получении режимов отправки событий
[+] Добавлены типы PlatformEvents, PlatformEventsInfo, Postgres для внешнего интерфейса

4.2.4

[*] Исправлен двойной вызов расширения api

4.3.0

[+] В fetcher добавлен добавлен параметр "ca" для самоподписных сертификатов

4.3.1

[*] При отсутствии трассировки дополнения с типом TraceModeTypes.MANUAL больше не приводят к крашу сервиса
[*] Изменены аргументы событий ready и terminate
[*] Игнорирование всех файлов в папке с контроллерами кроме js (актуально для ts сервисов)

4.4.0

[+] Добавлен новый резолвер для спеков filter://<Type>.
    Этот резолвер нужен, чтобы описать параметры для динамического фильтра https://wiki.esoft.team/e/ru/usefull/dynamic-filter

4.5.0

[+] Добавлен шаред тип ShortTime

4.6.0

[*] Добавлены типы для Extensions сервисов

4.6.1

[+] Добавил шаред тип ShortTime в sharedResolver/components

4.7.0

[*] Определение класса ошибки скорректированно в условиях потери правильного прототипа в пакетах
[-] Удалены settlement
[+] Возможность отправки запросов на реплику
[+] Максимальный размер кеша для одного ключа
[+] Отправка спеки происходит из одного буфера стримом и больше не приводит к приходу ООМ убийцы при большом количестве запросов на схему
[+] В расширении fetcher теперь можно получить stream вместо готовых данных
[*] Null, array, object никогда не будут переводится в строку, если в схеме нужна строка (ранее переводилось и объект становился [object Object])
[*] Null и default значения вновь проходят валидацию (баг)
[*] Null никогда не будет переводится в число, если в схеме нужно число (ранее приводилось и null становился 0)
[*] Исправлен баг, при котором SQL запросы всегда попадали в трассировку

4.7.1

[*] Исправлен тип для событий в сервисы: уточнён тип для уникального события

4.7.2

[*] Исправлена ошибка при которой value шаред типа Filter мог конвертироваться в массив и строку одновременно
    (отключена конвертация типов для oneOf)

4.7.3

[*] Поправлен логер в расширении MySQL
[*] Пофикшены falsy значения в комплексных схемах; 0 null и прочие значения не являлись валидными, даже если по схеме допускаются
[*] Пофикшена запись логов у плагина

4.8.0

[+] В fetcher добавлен параметр "xmlEncoded", добавлена возможность отправлять application/xml
[+] fetcher теперь сериализует ответ в зависимости от заголовков ответа

4.8.1

[*] Исправлено описание типа для Logger
[+] Добавлено описание типа для Fetcher

4.9.0

[+] Добавил в fetcher пропсы isRawBody и isRawResponse, и responseHeaders в возвращаемый объект

4.9.1

[*] В fetcher исправлена ошибка при парсинге FormData (не работал uploader)

4.9.2

[*] Функция поиска ипа теперь работает на актуальной версии ноды
[*] Скорректировано названия события для включения дебаг режима

4.9.3

[*] Исправлена запись null значения в качестве кеша каталога
[*] Улучшена трассировка для расширения для загрузки каталогов

4.9.4

[*] Исправлены паттерны в шаредных типах

4.9.5

[*] Исправлены описания типов

4.9.6

[*] Исправлен тип для ServiceError (кидал ошибку типов базового конструктора при попытке наследования)
[*] Исправлен источник данных каталога в трассировке для расширения catalogs
[*] Исправлены тесты для расширения для загрузки каталогов

4.9.7

[*] Исправлен тип для EventEmitter

4.10.0
[+] Добавлено расширение "return" для расширения pg. Работает по принципу knex().returning('column') для поддержания
    старой версии кнекс запросов. Возвращает массив значений
[*] Исправлены описания типов класса хуков и локализации
[*] Исправлены типы расширения Permissions и класса Extension

4.10.1

[+] Добавлен шаредный тип PlateText

4.10.2

[+] Опция отключения поиска сервиса по ипу, косяк в дискавери, резкий фикс, удалится после нового апи

4.11.0
[+] Класс SpecLoader доступен для внешнего интерфейса
[+] Тип класса Extension стал generic типом

4.12.0

[+] Добавлена функция "scan" в "redisConnector", ищущая по префиксу ключа и выполняющая callback
[+] Добавлена функция "removeByPrefix" в "cache", работающая по принципу "SCAN" из redis
[+] Добавлена функция "addToRingBuffer" в "cache", реализующая добавление значения в кольцевой буфер
[+] Добавлена функция "getFromRingBuffer" в "cache", реализующая получение значения из кольцевого буфера

4.13.0

[+] Добавлен параметр конфигурации buildPath

4.14.0

[+] Добавлено расширение ClickHouse для общения с одноименной БД.
[+] Класс ClickHouseQueryBuilder доступен для внешнего интерфейса.
[+] Добавлена типизация для расширения metrics.
[+] Добавлена строгая версия типизации расширения Api
[+] Добавлены интерфейсы Services и Extensions, которые можно переопределять в сервисах
[+] Добавлен тип OperationHandler для типизации функций контроллера
[*] Поправлена типизация функции registerMetric у Service.

4.15.0

[+] Добавлены пространства имен для расширение "cache" с поддержки разных типов кэширования при помощи функции "namespace" у расширения.
[+] Добавлена поддержка типа кэширования "base" для обычного key-value кэша.
[+] Добавлена поддержка типа кэширования "lfu" для ограниченного по количеству ключей кэша с вытеснением по алгоритму LFU.
[+] Добавлена типизация расширения "cache".
[-] Удалена функция "addToRingBuffer" из расширения "cache".
[-] Удалена функция "getFromRingBuffer" из расширения "cache".

4.15.1

[+] Добавлена поддержка булевых значений для shared://FilterItem.

4.16.0

[+] Добавлена возможность в расширениях указывать зависимость от других расширений
[*] Исправлены описания типов для статических свойств классов Service и Extension
[*] Добавлена типазация контекста в Extension
[+] Добавлена типизация для расширения uploader

4.17.0

[*] Исправлена дата в логах плагинов
[+] Новые состояния для сервиса
[+] Путь активации для service discovery
[*] Изменен протокол общения с ядром
[-] Удален UI, марс остается единственным
[-] Заголовки CORS для UI
[*] API теперь обращается в балансер, а не сервисы напрямую
[-] Куки больше не парсятся
[-] Различные зависимости, теперь их определяет ядро самостоятельно
[-] Контроллер сервисов и все что с ним связано
[*] Заголовки меты преведены в соответствии с новым протоколом ядра
[*] Лишние конфиги удалены, добавлены конфиги для балансера
[+] При завершении отправляем команду балансировщику, что мы устали
[+] События опправляют обратно ид трейса
[*] Указываем, что трейс является корневым, если у нас нет контекста переданного от кого-то извне
[+] Добавлено приложение и версия приложения, которое обращается в сервис
[*] Дополнения докостылены для работы с обеими версиями ядра, нужно почистить все, где в комментах есть clear mark

4.17.1

[*] Фикс потери контекста в функциях, которые изменяют входящие или исходящие данные в хуках (changeIncomingValue, changeOutgoingValue)
[*] Фикс падения сервиса от неправильно выводимых ошибок в консоль
[*] Сервис умеет персонально откликаться на просьбу зарегистрироваться в диспатчере
[*] Добавлены недостающие ошибки в обработку, которые может прислать балансировщик

4.18.0

[+] При фатальных эксепшенах они пишутся в консоль и сервис отсылает команду на исключение себя из балансировки перед смертью
[+] В методы сервиса теперь приходит контекст плагинов
[+] Добавлено событие activation, которое происходит в момент активации сервиса ядром
[*] Оптимизированы операции добавления во внутренний кеш
[*] Не берем из внутреннего кеша каталог, если нас при вызове попросили не кешировать его
[*] Убраны все зависимости из расширений, они теперь не нужны
[*] В дополнении каталогов источники переименованы в более логические: external - внешний кеш (редис), internal - внутренний кеш (память сервиса)
[+] Системные расширения в глупых сервисах имеют доступ к апи (локализация, файлы, каталоги)

4.19.0

[+] События можно типизировать подобно api
[+] Алиасы для ошибок PostgreSQL в дополнении postgres

4.19.1

[*] Пофикшена совместимость типов событий.

4.20.0

[+] Добавлено расширение accessControl для проверки доступа к сущности по набору атрибутов
[+] Добавлен опциональный аргумент hooks для конструктора класса Plugin
[*] Исправлено описание типа для расширения Permission

4.21.0
[+] Добавлены метрики для дополнения cache.
[*] Пофикшен сбор метрик ev_cn_pl_s_cnt и ev_rt_it_cnt

4.21.1
[*] Исправлена работа метода "removeByPrefix" расширения "cache".

4.22.0

[*] Контекст плагинов теперь прокидывается в динамические дополнения и обработчики событий

4.22.1

[*] В значение cache можно положить все кроме undefined

4.23.0

[+] Добавлена ошибка при большом теле ответа
[-] Убран код для совместимости с 3 версией сервисов
[+] Заголовок процесса устанавливается исходя из имени сервиса
[*] Подготовка к обновлению версии пакета etcd3 (нода >= 16)

4.24.0

[+] Добавлена поддержка оператора $ts в спецификации фильтра

4.25.0

[+] Добавлена поддержка оператора $intpf для спецификации фильтров

4.25.1

[*] Исправлены типы для расширений. Колбек для api().catch сделан опциональным

4.26.0

[+] Добавлены шаредные типы GeoLon и GeoLat для координат в типе string

4.27.0

[+] Добавлены типы хуков onErrorOperationName и onErrorEventEventName, срабатывающие при ошибке основной операции.

4.28.0

[+] Добавлено новое событие registration, которое происходит ДО регистрации сервиса, но после его старта
[+] Добавлен новый тип событий; они позволяют синхронно запускать события сервиса: activation, registration, ready, terminate

4.29.0

[+] Добавлена возможность генерировать типы для API сервиса.

4.30.0

[+] В расширение metrics добавлен метод replace, который позволяет заменить значение метрики на переданное (для типа Gauge)

4.31.0
[*] Исправлена ошибка, которая возникает при завершении сервиса до загрузки координатора
[+] Async Insert для INSERT запросов в клик
[*] Закрываем все ресурсы перед завершением сервиса (http пулы, подключение к базам, вызываем функцию заврешения у дополнений)
[*] Сервис больше не отвечает на пинги диспатчера, если он в процессе активации или завершения
[*] Дебаг сообщения теперь всегда пишутся, если запрос был выполнен с марса
[+] В дополнения теперь приходит traceId (для записи куда либо, отправке и пр)
[+] В логах теперь пишется трейс в рамках которого был вызван этот лог
[+] Добавлены пользовательские действия
[*] Поведение постоянных подключений синхронизировано с ядром

4.31.1

[*] Исправлен баг при котором отсутствовал трейс при записи логов в хранилище

4.31.2

[*] Изменена генерация типов для API сервисов

4.31.3

[*] Добавлено дефолтное время закрытия коннекта к бд

4.32.0

[+] Добавлен новый тип кэша для дополнения `cache` - `lru`
[*] Перенесена логика проверки политик доступа в фреймворк.
[*] Добавлено кэширование данных для дополнения `accessControl`.

4.33.0

[*] Добавлена поддержка дополнительных меток при регистрации сервиса.

4.34.0

[+] Добавлены кастомные дополнения (featureFlags)

4.34.1

[+] Добавлена обработка тайм-аутов БД для pg.

4.36.0

[+] Исключена возможность перевода русского языка на русский язык в дополнении `localization`

4.36.1

[+] Сервис теперь отдает в том числе свое имя при запросах /health

4.36.2

[+] Теперь при недоступности сервиса локализации удаляется обёртка `l10n` внутри дополнения `localization`.

4.37.0

[+] Добавлено дополнение Locks, реализующие распределенные блокировки

4.37.1

[*] Исправлено сбрасывание falsy значений фичефлагов на дефолтное.

4.38.0

[+] Добавлено подключение к архиву.

4.39.0

[+] Добавлена функция "getKeysByPrefix" расширения "cache", для получения ключей по префиксу